---
title: "Outliers"
output: 
      github_document: default
      html_notebook: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Outliers en Modelos ARIMA
Vamos a considerar el análisis de outliers para modelos ARIMA o SARIMA.

La base fundamental del análisis de outliers se basa en en análisis de intervención. Vamos a empezar con unos ejercicios de simulación. La librería base es tsoutliers.

```{r simulación aditivo }
library(tsoutliers)
library(forecast)
###### Simulación Outlier aditivo

set.seed(12)
n=200
serie=arima.sim(n=n,list(ar=(0.5)))
serie2=serie
serie2[50]=serie2[50]+6

par(mfrow=c(1,2))
plot(serie,ylim=c(-3,6),main="Serie original")
plot(serie2,ylim=c(-3,6),main="Outlier aditivo")
```

Después de simular un outlier aditivo en el tiempo $t=50$ con impacto de 6, basada en una serie que proviene de de un modelo AR con $\phi=0.5$.

En seguida vamos ajustar los modelos a las series con y sin outlier vía el procedimiento automático.
```{r ajuste de dos modelo}
auto.arima(serie2)###Ajuste para el modelo con outlier
auto.arima(serie)###Ajuste para el modelo sin outlier
fit= arima(serie2,order=c(1,0,0),include.mean = F)
fit
resi= residuals(fit)
plot(resi)
```
Note que el residual correspodiente a la observación 50 es bastante grande.

## Detección de outliers: procedimiento automático

```{r detección automática de outliers }
coef= coefs2poly(fit)
coef
outliers= tsoutliers::locate.outliers(resi,coef)
outliers###tstat se compara con C=3
?tso####Detección automática de outliers, donde el modelo que se propone es via auto.arima
tso(serie2)
```
## Simulación Outlier cambio de nivel
```{r Cambio de nivel}
set.seed(12)
n=500
serie=arima.sim(n=n,list(ar=0.3))
serie2=serie
serie2[100:n]=serie2[100:n]+4
par(mfrow=c(1,2))
plot(serie,ylim=c(-3,7),main="Serie original")
plot(serie2,ylim=c(-3,7),ylab="Serie")
plot(serie2,ylim=c(-3,7),main="Outlier cambio de nivel")
```


